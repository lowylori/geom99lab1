<!DOCTYPE html>
<!-- source: https://developers.google.com/maps/documentation/javascript/overview#maps_map_simple-html -->
<html>
  <head>
    <title>Drive to Hike</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script>   
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
        #map {
          height: 100%;
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
          height: 100%;
          margin: 0;
          padding: 0;
        }
    </style>
    <script>
      let map;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 43.761, lng: -79.411 },
          zoom: 10,
        });
      
      // https://developers.google.com/maps/documentation/javascript/shapes#circles
      // Construct a 40 km circle around the center of the map
        const circle = new google.maps.Circle({
          strokeColor: "#FF0000",
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: "#FF0000",
          fillOpacity: 0.35,
          map: map,
          center: { lat: 43.761, lng: -79.411 },
          radius: 40000
          });
      }

      // Create cluster points for trailheads
      // load csv file and parse content
      Papa.parse("https://lowylori.github.io/geom99lab1/storymap/ontariotrailheads.csv", {
        download: true,    //since the file is not local
        header: true,
        dynamicTyping: true,
        complete: function (result) {
          const locations = result.data.map(row => ({
            lat: parseFloat(row.Latitude),  //ensure its parsed as a number
            lng: parseFloat(row.Longitude),
          }));
        console.log(locations); //for developing purposes
        // create markers based on location
          const markers = locations.map((location, i) => {
            console.log('Creating Markers:', location);
            return new google.maps.Marker({
              position: {lat: location.lat, lng: location.lng},
            });
          });
          console.log(markers); //for developing purposes
          // Add a marker clusterer to manage the markers.
          new MarkerClusterer(map, markers, {
            imagePath:
            "https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",
            });
          },
        });
      

    </script>
  </head>
  <body>
    <div id="map"></div>
    
    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <!-- *** STUDENTS: Replace YOUR_API_KEY text with provided key in class for property src in next line *** -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDv3MGflguusDaLmV_-BUlmuoUI4EbM88w&callback=initMap&v=weekly" defer>
    </script>
  </body>
</html>
